# Story 1.5: Dashboard Layout & 8 Agent Houses

## Status
InProgress

## Executor Assignment
executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: [lint, typecheck, build]

## Story
**As a** user,
**I want** to see a side-scrolling horizontal dashboard with 8 distinct "houses" representing each agent in the pipeline,
**so that** I can visually understand the structure of the consultancy workflow and which agents are involved.

## Acceptance Criteria
1. Dashboard component created at `frontend/src/components/Dashboard.tsx`
2. Layout is horizontal side-scrolling container
3. 8 agent houses rendered in sequence: MASTER, Pesquisa, Organizador, Solucoes, Estruturas, Financeiro, Closer, Apresentacao
4. Each house is a card/box component (`AgentHouse.tsx`) with: unique color, agent name, icon/emoji, status indicator
5. Houses evenly spaced with visual connectors (bridges/paths)
6. Minimum house width: 200px, height: 250px
7. Smooth scroll behavior
8. Houses responsive: on smaller screens scale down proportionally
9. Zustand store: `useAgentStore.ts` with state: `agents: AgentState[]`
10. Dashboard reads from Zustand store and renders houses dynamically

## ðŸ¤– CodeRabbit Integration

### Story Type Analysis
**Primary Type**: Frontend
**Secondary Type(s)**: None
**Complexity**: Medium

### Specialized Agent Assignment
**Primary Agents**:
- @dev: Implementation

**Supporting Agents**:
- @ux-design-expert: Validate visual design matches UX spec

### Quality Gate Tasks
- [ ] Pre-Commit (@dev): Run before marking story complete

### CodeRabbit Focus Areas
**Primary Focus**:
- Accessibility: Semantic HTML, aria-labels on houses
- Performance: No unnecessary re-renders
- Responsive: Scale correctly at different viewports

## Tasks / Subtasks

- [x] Task 1: Create useAgentStore (AC: 9)
  - [x] Create `frontend/src/stores/useAgentStore.ts`
  - [x] Initialize with 8 agents from AGENT_DEFINITIONS (shared/types.ts)
  - [x] Implement: updateAgent, setActiveAgent, markCompleted, resetAll
  - [x] Set initial positions (x) for each agent house (400px apart, starting at 200px)
- [x] Task 2: Create AgentHouse component (AC: 4, 6)
  - [x] Create `frontend/src/components/AgentHouse.tsx`
  - [x] Props: agent (AgentState)
  - [x] Render: colored card with agent icon, name, status badge
  - [x] Status indicator: gray (idle), yellow pulse (processing), green (done), red (error)
  - [x] Min width 200px, height 250px
  - [x] Agent-specific border color with glow effect
  - [x] `aria-label="{name}, status: {status}"`
- [x] Task 3: Create Dashboard layout (AC: 1, 2, 3, 5, 7)
  - [x] Create `frontend/src/components/Dashboard.tsx`
  - [x] Horizontal scrolling container (overflow-x: auto, scroll-smooth)
  - [x] Render 8 AgentHouse components from store
  - [x] Visual connectors between houses (green neon lines)
  - [x] Scroll padding for first/last house
- [x] Task 4: Create StatusBadge atom (AC: 4)
  - [x] Create `frontend/src/components/atoms/StatusBadge.tsx`
  - [x] Props: status (AgentStatus)
  - [x] Colored dot + label text
  - [x] Pulse animation for 'processing' status
- [x] Task 5: Integrate into App.tsx (AC: all)
  - [x] Import Dashboard into App.tsx
  - [x] Render below connection status
  - [x] Apply Matrix theme background
- [x] Task 6: Responsive behavior (AC: 8)
  - [x] Houses scale: 200px (xl) â†’ 160px (lg) â†’ 128px (md)
  - [x] Responsive via Tailwind breakpoints

## Dev Notes

### Architecture Reference
From `system-architecture.md` Section 2.3 â€” useAgentStore:
```typescript
interface AgentStore {
  agents: AgentState[];
  activeAgent: AgentId | null;
  completedSteps: AgentId[];
  updateAgent: (id: AgentId, patch: Partial<AgentState>) => void;
  setActiveAgent: (id: AgentId) => void;
  markCompleted: (id: AgentId) => void;
  resetAll: () => void;
}
```

From `ux-spec.md` Section 5 â€” Agent House Design:
- House structure: 128x128 base size (CSS placeholder version for now)
- Status states: idle (opacity 0.6, grayscale 50%), processing (yellow border, pulse), done (green border, checkmark), error (red border, shake)
- Connectors: green neon lines between houses

**Agent colors** (use as border/glow color):
| Agent | Color |
|-------|-------|
| MASTER | #8B5CF6 |
| Pesquisa | #2563EB |
| Organizador | #059669 |
| Solucoes | #F59E0B |
| Estruturas | #374151 |
| Financeiro | #10B981 |
| Closer | #DC2626 |
| Apresentacao | #EC4899 |

**House positions** in Phaser world (for future Phaser integration):
- 8 houses, 400px apart, starting at x=200
- World width: 4000px

### Testing
- Manual visual validation
- Verify all 8 houses render with correct colors and names

### Dependency
- **Depends on:** Story 1.1 (shared types, frontend setup), Story 1.3 (Tailwind theme)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-27 | 1.0 | Story created from PRD Epic 1 | River (SM) |

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6 (@dev / Dex)

### Debug Log References
- TypeScript: 0 errors
- Vite build: 81 modules, 2.15s, 193KB bundle

### Completion Notes List
- useAgentStore initialized from AGENT_DEFINITIONS with positions 400px apart
- AgentHouse has glow, opacity, grayscale per status from UX spec
- Dashboard with horizontal scroll, green neon connectors between houses
- StatusBadge atom with pulse animation for processing
- Responsive breakpoints: xl 200px, lg 160px, md 128px

### File List
- `frontend/src/stores/useAgentStore.ts` â€” Zustand agent store (new)
- `frontend/src/components/Dashboard.tsx` â€” Horizontal scroll layout (new)
- `frontend/src/components/AgentHouse.tsx` â€” Agent card component (new)
- `frontend/src/components/atoms/StatusBadge.tsx` â€” Status indicator atom (new)
- `frontend/src/App.tsx` â€” Integrated Dashboard

## QA Results

### Gate Decision: âœ… PASS with CONCERNS

**Reviewer:** Quinn (QA) | **Date:** 2026-02-27 | **Model:** Claude Opus 4.6

### Acceptance Criteria Traceability

| AC | CritÃ©rio | Status | EvidÃªncia |
|----|----------|--------|-----------|
| 1 | Dashboard.tsx criado | âœ… PASS | `components/Dashboard.tsx` |
| 2 | Layout horizontal side-scrolling | âœ… PASS | `overflow-x-auto scroll-smooth` |
| 3 | 8 agent houses em sequÃªncia | âœ… PASS | Renderiza de `AGENT_DEFINITIONS` (8 agents) |
| 4 | House com cor, nome, icon, status | âœ… PASS | `AgentHouse.tsx` â€” border color, icon, name, StatusBadge |
| 5 | Connectors entre houses | âœ… PASS | `Dashboard.tsx:17` â€” green neon line `w-12 h-0.5` |
| 6 | Min width 200px, height 250px | âœ… PASS | `AgentHouse.tsx:16` â€” `w-[200px] h-[250px]` |
| 7 | Smooth scroll | âœ… PASS | `scroll-smooth` class |
| 8 | Responsive | âœ… PASS | `xl:w-[200px] lg:w-[160px] md:w-[128px]` breakpoints |
| 9 | Zustand useAgentStore | âœ… PASS | `useAgentStore.ts` com updateAgent, setActiveAgent, markCompleted, resetAll |
| 10 | Dashboard lÃª do store | âœ… PASS | `Dashboard.tsx:5` â€” `useAgentStore((s) => s.agents)` |

### Build Verification

| Check | Status |
|-------|--------|
| `tsc --noEmit` | âœ… PASS |
| `vite build` | âœ… PASS |

### Concerns (nÃ£o bloqueantes)

1. **Dashboard seleciona `s.agents` (array inteiro)** (`Dashboard.tsx:5`) â€” Qualquer mudanÃ§a em qualquer agente re-renderiza todos os 8 AgentHouse. A story nota do dev (architecture Section 2.3) recomenda seletores por agentId. Severity: MEDIUM â€” aceitÃ¡vel para 8 items, otimizar se performance degradar.
2. **`animate-[shake_0.3s_ease-in-out]` nÃ£o definido** (`AgentHouse.tsx:23`) â€” A animaÃ§Ã£o `shake` nÃ£o existe em `tailwind.config.js`. O estado error nÃ£o terÃ¡ animaÃ§Ã£o. Severity: LOW â€” error state ainda mostra border vermelha.
3. **Sem testes automatizados** â€” Story especifica "Manual visual validation", aceitÃ¡vel.

### Verdict

**PASS** â€” Todos os 10 ACs verificados. Arquitetura segue o spec. Concerns de baixa severidade.
