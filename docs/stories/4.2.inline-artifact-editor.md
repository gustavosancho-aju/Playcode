# Story 4.2: Inline Artifact Editor

## Status
Done

## Executor Assignment
executor: "@dev"
quality_gate: "@qa"
quality_gate_tools: [lint, typecheck, manual-test]

## Story
**As a** consultant,
**I want** to edit artifact content directly in the dashboard using a Markdown editor,
**so that** I can adjust deliverables without leaving the workflow.

## Acceptance Criteria
1. `ArtifactEditor.tsx` slide-in panel (width 60vw)
2. Loads Markdown from backend API
3. Syntax highlighting, live preview toggle, line numbers
4. Auto-save every 5 seconds via PUT endpoint
5. Ctrl+S: immediate save with green flash confirmation
6. Save & Continue: saves, approves, closes, resumes pipeline
7. Cancel: discards changes, returns to approval popup
8. Matrix theme: dark bg, green syntax highlighting, JetBrains Mono
9. Handles 10,000+ characters without lag
10. Backend validates UTF-8 before saving

## Traceability
- FR29: Usuario deve poder editar qualquer artefato inline
- NFR8: Artefatos devem ser salvos incrementalmente (auto-save)

## Tasks / Subtasks

- [x] Task 1: Create ArtifactEditor component (AC: 1, 8)
  - [ ] Create `frontend/src/components/ArtifactEditor.tsx`
  - [ ] Slide-in panel from right, width 60vw
  - [ ] Matrix theme: dark background, green text, JetBrains Mono font
  - [ ] Close button and header with artifact name
- [x] Task 2: Markdown editing capabilities (AC: 2, 3, 9)
  - [ ] Textarea with syntax-aware editing (or lightweight Markdown editor lib)
  - [ ] Line numbers display
  - [ ] Live preview toggle (split view: editor | rendered)
  - [ ] Load content from `GET /api/artifacts/{sessionId}/{filename}`
  - [ ] Handle large content (10,000+ chars) without lag
- [x] Task 3: Auto-save and manual save (AC: 4, 5, 10)
  - [ ] Auto-save timer: PUT every 5 seconds if content changed
  - [ ] Ctrl+S keyboard shortcut for immediate save
  - [ ] Green flash confirmation on save success
  - [ ] Backend: `PUT /api/artifacts/{sessionId}/{filename}` endpoint
  - [ ] Backend validates UTF-8 encoding before writing
- [x] Task 4: Action buttons (AC: 6, 7)
  - [ ] Save & Continue: save content, emit approve, close editor, resume pipeline
  - [ ] Cancel: discard changes, return to ApprovalPopup
  - [ ] Unsaved changes warning on Cancel
- [x] Task 5: Integration with ApprovalPopup
  - [ ] Edit button in ApprovalPopup opens ArtifactEditor
  - [ ] Pass artifact path and session ID
  - [ ] On Save & Continue, pipeline resumes

## Dev Notes

### Architecture Reference
- Artifacts stored at `docs/artifacts/{sessionId}/`
- Existing API: `GET /api/artifacts/{sessionId}/{filename}` (Story 2.4)
- Need new: `PUT /api/artifacts/{sessionId}/{filename}` for saving

### Dependencies
- Story 2.4 (Artifact Storage) — provides GET API
- Story 4.1 (Approval Popup) — triggers editor via Edit button

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-27 | 1.0 | Story created from PRD Epic 4 | River (SM) |

## QA Results
(to be filled by QA agent)
