# Story 4.4: Commercial Proposal Generator

## Status
Done

## Executor Assignment
executor: "@dev"
quality_gate: "@qa"
quality_gate_tools: [lint, typecheck, manual-test]

## Story
**As a** consultant,
**I want** the Closer agent to generate a professional commercial proposal in editable Markdown,
**so that** I can deliver a polished document to client executives.

## Acceptance Criteria
1. Closer prompt includes: cover, executive summary (AIDA), problem statement, proposed solutions, investment/ROI table, timeline, differentiators (PAS), next steps/CTA
2. Professional formatting: headers, tables, bullets, emphasis
3. Financial data in BRL (R$), percentages, comparison tables
4. Placeholders for: `{{client_logo}}`, `{{consultant_signature}}`
5. Markdown passes lint check
6. Saved as `06-proposta-comercial.md`
7. HTML preview endpoint: `GET /api/artifacts/{sessionId}/proposta/preview`
8. Length: 4-8 pages (2000-4000 words)
9. Print-to-PDF via browser (CSS print styles included)
10. Sections re-orderable without breaking formatting

## Traceability
- FR25: Closer gera proposta-comercial.md com AIDA/PAS/StoryBrand
- FR27: Artefatos salvos em docs/artifacts/{session-id}/

## Tasks / Subtasks

- [x] Task 1: Enhance Closer agent prompt (AC: 1, 2, 3, 4, 8)
  - [ ] Update `agents/closer.md` with detailed proposal structure
  - [ ] Include AIDA framework for executive summary
  - [ ] Include PAS framework for differentiators section
  - [ ] Specify BRL formatting for financial tables
  - [ ] Add placeholder tokens: `{{client_logo}}`, `{{consultant_signature}}`
  - [ ] Target length: 2000-4000 words
- [x] Task 2: Artifact naming and storage (AC: 5, 6)
  - [ ] Ensure artifact saved as `06-proposta-comercial.md`
  - [ ] Validate Markdown structure on save
- [x] Task 3: HTML preview endpoint (AC: 7, 9)
  - [ ] Add `GET /api/artifacts/{sessionId}/proposta/preview` route
  - [ ] Convert Markdown to HTML with professional styling
  - [ ] Include CSS print styles for Print-to-PDF
  - [ ] Responsive layout for preview
- [x] Task 4: Modular sections (AC: 10)
  - [ ] Each section as independent Markdown heading (H2)
  - [ ] No cross-references that break on reorder
  - [ ] Clean separator between sections

## Dev Notes

### Architecture Reference
- Closer is agent 6 in pipeline (index 5)
- Input: outputs from Estruturas + Financeiro agents
- Current prompt at `agents/closer.md`

### Dependencies
- Story 2.1 (Agent Definitions) — base prompt to enhance
- Story 2.4 (Artifact Storage) — saving mechanism

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-27 | 1.0 | Story created from PRD Epic 4 | River (SM) |

## QA Results
(to be filled by QA agent)
