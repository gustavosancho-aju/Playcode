# Story 5.4: Pipeline de Conteudo Interativo

## Status
InProgress

## Executor Assignment
executor: "@dev"
quality_gate: "@qa"
quality_gate_tools: [lint, typecheck, manual-test]

## Story
**As a** usuario do Squad Playground,
**I want** poder editar artefatos inline durante o fluxo de aprovacao e co-criar conteudo com os agentes,
**so that** o resultado final reflita minha visao combinada com a capacidade dos agentes.

## Acceptance Criteria
1. ApprovalPopup evolui para um editor rico (nao apenas preview)
2. Editor suporta markdown com toolbar basica (bold, italic, headers, lists)
3. Edicoes do usuario sao salvas no artefato antes de passar para o proximo agente
4. O proximo agente recebe a versao EDITADA pelo usuario (nao a versao original)
5. Indicador visual de "editado por voce" vs "gerado pelo agente"
6. Botao "Resetar" para voltar ao conteudo original do agente
7. Suporte a upload de imagens (drag-and-drop ou botao)
8. Imagens salvas em `docs/artifacts/{sessionId}/images/`
9. Preview lado-a-lado: editor | rendered
10. Auto-save a cada 5 segundos enquanto editando

## Tasks / Subtasks

- [x] Task 1: Upgrade do ApprovalPopup para editor (AC: 1, 2, 9)
  - [x] Substituir preview read-only por textarea editavel
  - [x] Toolbar markdown (bold, italic, h1-h3, lista, code)
  - [x] Split view: editor | preview renderizado
- [x] Task 2: Salvar edicoes no artefato (AC: 3, 4, 10)
  - [x] POST /api/artifacts/:sessionId/:filename com conteudo editado
  - [x] Auto-save com debounce de 5s
  - [x] Ao aprovar, salvar versao final e passar para proximo agente
- [x] Task 3: Backend — receber versao editada (AC: 4)
  - [x] Orchestrator usa artefato editado como input do proximo agente
  - [x] Atualizar getPreviousOutput para ler artefato salvo
- [x] Task 4: Indicadores de edicao (AC: 5, 6)
  - [x] Badge "Editado" quando conteudo difere do original
  - [x] Botao "Resetar para original"
  - [x] Guardar versao original em memoria para comparacao
- [x] Task 5: Upload de imagens (AC: 7, 8)
  - [x] Dropzone no editor
  - [x] POST /api/artifacts/:sessionId/images com multipart
  - [x] Inserir referencia markdown no editor

## File List
- [x] `frontend/src/components/ApprovalPopup.tsx` — Markdown rendering no preview
- [x] `frontend/src/components/ArtifactEditor.tsx` — Split view, toolbar, indicadores, upload
- [x] `frontend/tailwind.config.js` — Plugin typography
- [x] `frontend/package.json` — react-markdown, remark-gfm, @tailwindcss/typography
- [x] `backend/src/routes/artifacts.ts` — Rotas de upload/servir imagens
- [x] `backend/package.json` — multer
- [x] `backend/src/pipeline/orchestrator.ts` — Já usava artefato editado (sem mudança necessária)

## Dependencies
- Story 5.1 (navegacao)
- ApprovalPopup existente
- artifactManager no backend
